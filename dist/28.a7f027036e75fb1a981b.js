(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{JrIE:function(l,e,n){"use strict";n.r(e);var s=n("CcnG"),u=function(){return function(){}}(),a=n("pMnS"),t=n("jvCn"),o=n("miAi"),i=n("wd/R"),r=(n("zavE"),n("TxLo")),d=n("vDqi"),c=n.n(d),m=$("#companyData"),g=function(){function l(l,e,n,s,u){var a=this;this._constant=l,this.router=n,this.spinner=s,this.toastr=u,this.base=this._constant.baseAppUrl,this.uri=this._constant.uri_track,this.user_id=Number(sessionStorage.getItem("setSessionstorageValueUserID")),this.reseller_id=Number(sessionStorage.getItem("setSessionstorageValueUserResellerID")),this.company_id=Number(sessionStorage.getItem("setSessionstorageValueUserCompanyID")),this.role_id=Number(sessionStorage.getItem("setSessionstorageValueRoleID")),this.username=sessionStorage.getItem("setSessionstorageValueUser"),this.company=sessionStorage.getItem("setSessionstorageValueCompany"),this.api_companies=this._constant.getCompanies(),this.api_drivers=this._constant.getDrivers(),this.router.events.subscribe((function(l){""!=e.path()&&(a.route=e.path())}))}return l.prototype.ngOnInit=function(){this.spinner.show();var l=this._constant.messagesApi,e=this._constant.getMessages(),n=(Number(sessionStorage.getItem("setSessionstorageValueUserID")),Number(sessionStorage.getItem("setSessionstorageValueUserResellerID")),Number(sessionStorage.getItem("setSessionstorageValueUserCompanyID")),sessionStorage.getItem("setSessionstorageValueCompany")),s=this._constant.getSessionstorageValueRoleID,u=this.spinner,a=this.toastr;1==s&&$("#load-reseller").val(),s>=3&&($("#_jds").hide(),$("#_routing").hide(),$("#_limits").hide(),$("#company_reseller").hide()),$.getJSON(this.api_drivers,(function(l){$.each(l,(function(l,e){e.Phone&&$("#messageRecipient").append($("<option></option>").val(e.Phone).html(e.Name))})),$(".selectpicker").selectpicker("refresh")})),m=$("#messagesData").DataTable({destroy:!0,responsive:!0,select:!0,filter:!0,fixedHeader:!1,colReorder:!1,rowReorder:!0,keys:!0,scrollX:!0,scrollCollapse:!0,stateSave:!0,paging:!0,pagingType:"full_numbers",pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],searching:!0,info:!0,dom:'<"addNew">Blfrtip',language:{zeroRecords:"Nothing found - sorry",infoEmpty:"No events available",infoFiltered:"(filtered from MAX total events)"},buttons:[{extend:"colvis",className:"float-right"},[{extend:"collection",text:"Export",className:"float-right",buttons:["excel","csv","pdf","print"]}],{extend:"copy",className:"copyBtn"},{text:"Refresh",className:"refreshBtn float-right ml-2",action:function(l,e,n,s){$("#messagesData").DataTable().ajax.reload()}}],columns:[{data:"MessageID",title:"Mesasge ID",className:"reorder"},{data:"Recipients",title:"Recipient",className:"reorder"},{data:"Message",title:"Message",className:"reorder"},{data:"Timestamp",title:"Date & Time",className:"reorder"},{data:"Flag",title:"Status",className:"reorder"},{data:null,title:"Action",className:"center",defaultContent:'<a class="editMessage"><i class="fa fa-edit"></i></a> &emsp; <a class="deleteMessage" data-toggle="modal"><i class="fa fa-trash"></i></a>'}],ajax:{url:e,type:"GET",dataType:"json",dataSrc:""},columnDefs:[{render:function(l,e,n){return"0001-01-01T00:00:00"==n.Timestamp?"---":i(l).add("hours",8).format("D-MMM-YYYY, hh:mm:ss A")},targets:3},{render:function(l,e){var n,s;return 0==l?(n="success",s="Sent"):1==l&&(n="warning",s="Pending"),'<div class="badge badge-'+n+'"> '+s+"</div>"},targets:4}],initComplete:function(l,e,s){$(".addNew").html('<button id="add" class="addBtn float-left">Add New</button>'),$("#add").on("click",(function(l){$("#messagesModal").modal("show"),$("#messagesFormTitle").text("Create New Message"),$("#messageID").val(""),$("#messageRecipient").val(""),$("#messageDateTime").val(o),$("#messageMessage").val(""),$("#messageStatus").val(""),function(l){var e,n,s=new Date,u=s.getDate(),a=s.getMonth()+1,t=s.getFullYear(),o=t=t.toString().substr(2,2);e=a<=9?"0"+a:a,n=u<=9?"0"+u:u;var i=l.split(" ")[0]+"-"+n+e+o+"-"+function(){for(var l="",e=0;e<6;e++){var n=Math.floor(Math.random()*"0123456789".length);l+="0123456789".substring(n,n+1)}return l}();$("#messageReportingID").val(i)}(n),$(".selectpicker").selectpicker("refresh")}))},footerCallback:function(l,e,n,s,u){}});var t=new Date;t.setDate(t.getDate());var o=i(t).format("D-MMM-YYYY HH:mm A");$("#messageDateTime").datetimepicker({format:"d-M-Y H:i A",theme:"dark",lang:"en",value:o,onChangeDateTime:function(l,e){$(this).hide()}}),$("#messagesData").on("click","a.editMessage",(function(l){u.show(),$("#messagesModal").modal("show"),$("#messagesFormTitle").text("Edit Message");var e=m.row($(this).parents("tr")).data();$("#messageID").val(e.MessageID),$("#messageRecipient").val(e.Recipients);var n=i.utc(e.Timestamp).toDate(),s=i(n).local().format("DD-MMM-YYYY, hh:mm:ss A");$("#messageDateTime").val(s),$("#messageStatus").val(e.Flag),$("#messageMessage").val(e.Message),$(".selectpicker").selectpicker("refresh"),u.hide()})),$("#messagesData").on("click","a.deleteMessage",(function(e){$("#deleteMessage").modal("show");var n=m.row($(this).parents("tr")).data();$("#messageID").val(n.MessageID),$("#deleteMessage").on("click",".deleteMessageBtn",(function(e){u.show();var s={MessageID:n.MessageID};c.a.delete(l+s.MessageID,s).then((function(l){console.log(l),$("#messagesModal").modal("hide"),$("#deleteMessage").modal("hide"),$("#messagesData").DataTable().ajax.reload(),a.success("Message Deleted","Success",{timeOut:3e3,closeButton:!0,enableHtml:!0}),u.hide()})).catch((function(l){console.log(l)}))}))})),this.spinner.hide()},l.prototype.onSubmit=function(){this.spinner.show();var l=this.spinner,e=this.toastr,n=Number(sessionStorage.getItem("setSessionstorageValueUserCompanyID")),s=$("#messageDateTime").val(),u=i(s,"DD-MMM-YYYY, HH:mm"),a=i.utc(u).format("DD-MMM-YYYY, HH:mm"),t=$("#messageRecipient").val(),o=$("#messageStatus").val(),r=$("#messageMessage").val();if(0!=t.length&&o&&0!=r.length)for(var d=0;d<t.length;d++){var m=t[d],g={MessageID:$("#messageID").val(),Sender:"SHN - Stay Home Notice System",Recipients:m,Message:$("#messageMessage").val(),Timestamp:a,RxTime:i().format(),Flag:$("#messageStatus").val(),CompanyID:n,AssetID:0,JobNumber:$("#messageReportingID").val(),Notified:0};"undefined"==g.MessageID||null==g.MessageID||0==g.MessageID?c.a.post(this._constant.messagesApi,g).then((function(n){console.log(n),$("#messagesModal").modal("hide"),$("#confirmMessage").modal("hide"),$("#messagesData").DataTable().ajax.reload(),b(),l.hide(),e.success("Message Saved Successful","Success",{timeOut:3e3,closeButton:!0,enableHtml:!0})})).catch((function(l){console.log(l)})):c.a.put(this._constant.messagesApi+this._constant.param_put+g.MessageID,g).then((function(n){console.log(n),$("#messagesModal").modal("hide"),$("#confirmMessage").modal("hide"),$("#messagesData").DataTable().ajax.reload(),b(),l.hide(),e.success("Message Updated Successful","Success",{timeOut:3e3,closeButton:!0,enableHtml:!0})})).catch((function(l){console.log(l)}))}else $("#confirmMessage").modal("hide"),this.spinner.hide(),this.toastr.error("Field must not be empty","Error",{timeOut:3e3,closeButton:!0,enableHtml:!0});function b(){$("#messageID").val(""),$("#messageRecipient").val(""),$("#messageDateTime").val(""),$("#messageStatus").val(""),$("#messageMessage").val("")}},l.prototype.clearForms=function(){$("#messageID").val(""),$("#messageRecipient").val(""),$("#messageDateTime").val(""),$("#messageStatus").val(""),$("#messageMessage").val("")},l}(),b=n("Ip0R"),p=n("ZYCi"),f=n("SZbH"),h=s.ub({encapsulation:0,styles:[[""]],data:{}});function v(l){return s.Yb(0,[(l()(),s.wb(0,0,null,null,3,"ngx-spinner",[["bdColor","rgba(51, 51, 51, 0.96)"],["size","medium"],["type","ball-spin-clockwise"]],null,null,null,t.b,t.a)),s.vb(1,770048,null,0,o.a,[o.c,s.h],{bdColor:[0,"bdColor"],size:[1,"size"],type:[2,"type"]},null),(l()(),s.wb(2,0,null,0,1,"p",[["style","color: white"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Please Wait. "])),(l()(),s.wb(4,0,null,null,92,"div",[["class","animated fadeIn"]],null,null,null,null,null)),(l()(),s.wb(5,0,null,null,91,"div",[["class","card"]],null,null,null,null,null)),(l()(),s.wb(6,0,null,null,2,"div",[["class","card-header"]],null,null,null,null,null)),(l()(),s.wb(7,0,null,null,1,"span",[["class","font-weight-bold"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Messages"])),(l()(),s.wb(9,0,null,null,87,"div",[["class","card-body module-dt"]],null,null,null,null,null)),(l()(),s.wb(10,0,null,null,2,"div",[["style","width: 100%;"]],null,null,null,null,null)),(l()(),s.wb(11,0,null,null,1,"div",[["class","table-responsive"]],null,null,null,null,null)),(l()(),s.wb(12,0,null,null,0,"table",[["cellspacing","0"],["class","table table-striped table-hover dt-responsive display tableth"],["id","messagesData"],["width","100%"]],null,null,null,null,null)),(l()(),s.wb(13,0,null,null,55,"div",[["aria-hidden","true"],["aria-labelledby","messagesModalLabel"],["class","modal fade"],["id","messagesModal"],["role","dialog"],["tabindex","-1"]],null,null,null,null,null)),(l()(),s.wb(14,0,null,null,54,"div",[["class","modal-dialog modal-xl modal-dialog-centered"],["role","document"]],null,null,null,null,null)),(l()(),s.wb(15,0,null,null,53,"div",[["class","modal-content"]],null,null,null,null,null)),(l()(),s.wb(16,0,null,null,5,"div",[["class","modal-header"]],null,null,null,null,null)),(l()(),s.wb(17,0,null,null,1,"h4",[["class","modal-title"],["id","messagesFormTitle"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Messages"])),(l()(),s.wb(19,0,null,null,2,"button",[["aria-label","Close"],["class","close"],["data-dismiss","modal"],["type","button"]],null,[[null,"click"]],(function(l,e,n){var s=!0;return"click"===e&&(s=!1!==l.component.clearForms()&&s),s}),null,null)),(l()(),s.wb(20,0,null,null,1,"span",[["aria-hidden","true"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,["\xd7"])),(l()(),s.wb(22,0,null,null,46,"div",[["class","modal-body"]],null,null,null,null,null)),(l()(),s.wb(23,0,null,null,45,"form",[["id","messagesModalForm"],["novalidate",""]],null,null,null,null,null)),(l()(),s.wb(24,0,null,null,4,"div",[["class","col-md-6 float-left pl-0"]],null,null,null,null,null)),(l()(),s.wb(25,0,null,null,3,"div",[["class","form-group d-none"]],null,null,null,null,null)),(l()(),s.wb(26,0,null,null,1,"label",[],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Message ID"])),(l()(),s.wb(28,0,null,null,0,"input",[["class","form-control"],["disabled",""],["id","messageID"],["name","messageID"],["placeholder","Message ID"],["type","text"]],null,null,null,null,null)),(l()(),s.wb(29,0,null,null,4,"div",[["class","col-md-6 float-left pl-0 d-none"]],null,null,null,null,null)),(l()(),s.wb(30,0,null,null,3,"div",[["class","form-group"]],null,null,null,null,null)),(l()(),s.wb(31,0,null,null,1,"label",[],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Reporting Message Info"])),(l()(),s.wb(33,0,null,null,0,"input",[["class","form-control"],["disabled",""],["id","messageReportingID"],["name","messageReportingID"],["placeholder","Reporting Message Info"],["type","text"]],null,null,null,null,null)),(l()(),s.wb(34,0,null,null,4,"div",[["class","col-md-6 float-left p-0"]],null,null,null,null,null)),(l()(),s.wb(35,0,null,null,3,"div",[["class","form-group"]],null,null,null,null,null)),(l()(),s.wb(36,0,null,null,1,"label",[],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Recipients *"])),(l()(),s.wb(38,0,null,null,0,"select",[["class","selectpicker form-control show-tick"],["data-live-search","true"],["data-width","100%"],["id","messageRecipient"],["multiple",""]],null,null,null,null,null)),(l()(),s.wb(39,0,null,null,0,"div",[["class","clearfix"]],null,null,null,null,null)),(l()(),s.wb(40,0,null,null,4,"div",[["class","col-md-6 float-left pl-0"]],null,null,null,null,null)),(l()(),s.wb(41,0,null,null,3,"div",[["class","form-group"]],null,null,null,null,null)),(l()(),s.wb(42,0,null,null,1,"label",[],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Date and Time"])),(l()(),s.wb(44,0,null,null,0,"input",[["class","form-control"],["id","messageDateTime"],["placeholder","DD-MMM-YYYY HH:MM"],["type","text"]],null,null,null,null,null)),(l()(),s.wb(45,0,null,null,8,"div",[["class","col-md-6 float-left p-0"]],null,null,null,null,null)),(l()(),s.wb(46,0,null,null,7,"div",[["class","form-group"]],null,null,null,null,null)),(l()(),s.wb(47,0,null,null,1,"label",[],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Status *"])),(l()(),s.wb(49,0,null,null,4,"select",[["class","selectpicker"],["data-width","100%"],["id","messageStatus"]],null,null,null,null,null)),(l()(),s.wb(50,0,null,null,1,"option",[["selected","selected"],["value","1"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Pending"])),(l()(),s.wb(52,0,null,null,1,"option",[["value","0"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Sent"])),(l()(),s.wb(54,0,null,null,0,"div",[["class","clearfix"]],null,null,null,null,null)),(l()(),s.wb(55,0,null,null,4,"div",[["class","col-md-12 float-left p-0"]],null,null,null,null,null)),(l()(),s.wb(56,0,null,null,3,"div",[["class","form-group"]],null,null,null,null,null)),(l()(),s.wb(57,0,null,null,1,"label",[],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Message *"])),(l()(),s.wb(59,0,null,null,0,"textarea",[["class","form-control"],["data-by-field","messageMessage"],["id","messageMessage"],["name","messageMessage"],["placeholder","Message"],["required",""],["rows","4"],["type","text"]],null,null,null,null,null)),(l()(),s.wb(60,0,null,null,0,"br",[],null,null,null,null,null)),(l()(),s.wb(61,0,null,null,0,"div",[["class","clearfix"]],null,null,null,null,null)),(l()(),s.wb(62,0,null,null,6,"div",[["class","modal-footer"]],null,null,null,null,null)),(l()(),s.wb(63,0,null,null,2,"button",[["class","btn btn-secondary"],["data-dismiss","modal"],["type","button"]],null,[[null,"click"]],(function(l,e,n){var s=!0;return"click"===e&&(s=!1!==l.component.clearForms()&&s),s}),null,null)),(l()(),s.wb(64,0,null,null,0,"i",[["class","fa fa-times fa-fw"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,[" Close"])),(l()(),s.wb(66,0,null,null,2,"button",[["class","btn btn-primary"],["data-toggle","modal"],["href","#confirmMessage"],["id","submit-message"],["type","button"]],null,null,null,null,null)),(l()(),s.wb(67,0,null,null,0,"i",[["class","fa fa-check fa-fw"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,[" Send Message"])),(l()(),s.wb(69,0,null,null,13,"div",[["class","modal fade"],["id","confirmMessage"]],null,null,null,null,null)),(l()(),s.wb(70,0,null,null,12,"div",[["class","modal-dialog modal-dialog-centered modal-confirm"]],null,null,null,null,null)),(l()(),s.wb(71,0,null,null,11,"div",[["class","modal-content"]],null,null,null,null,null)),(l()(),s.wb(72,0,null,null,4,"div",[["class","modal-header"]],null,null,null,null,null)),(l()(),s.wb(73,0,null,null,1,"h4",[["class","modal-title"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Please Confirm..."])),(l()(),s.wb(75,0,null,null,1,"button",[["aria-hidden","true"],["class","close"],["data-dismiss","modal"],["type","button"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,["\xd7"])),(l()(),s.wb(77,0,null,null,2,"div",[["class","modal-body"]],null,null,null,null,null)),(l()(),s.wb(78,0,null,null,1,"p",[],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Do you wish to proceed with the updates?"])),(l()(),s.wb(80,0,null,null,2,"div",[["class","modal-footer"]],null,null,null,null,null)),(l()(),s.wb(81,0,null,null,1,"button",[["class","btn btn-danger"],["type","button"]],null,[[null,"click"]],(function(l,e,n){var s=!0;return"click"===e&&(s=!1!==l.component.onSubmit()&&s),s}),null,null)),(l()(),s.Vb(-1,null,["Send"])),(l()(),s.wb(83,0,null,null,13,"div",[["class","modal fade"],["id","deleteMessage"]],null,null,null,null,null)),(l()(),s.wb(84,0,null,null,12,"div",[["class","modal-dialog modal-dialog-centered modal-confirm"]],null,null,null,null,null)),(l()(),s.wb(85,0,null,null,11,"div",[["class","modal-content"]],null,null,null,null,null)),(l()(),s.wb(86,0,null,null,4,"div",[["class","modal-header"]],null,null,null,null,null)),(l()(),s.wb(87,0,null,null,1,"h4",[["class","modal-title"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Are you sure?"])),(l()(),s.wb(89,0,null,null,1,"button",[["aria-hidden","true"],["class","close"],["data-dismiss","modal"],["type","button"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,["\xd7"])),(l()(),s.wb(91,0,null,null,2,"div",[["class","modal-body"]],null,null,null,null,null)),(l()(),s.wb(92,0,null,null,1,"p",[],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Do you really want to delete these records? This process cannot be undone."])),(l()(),s.wb(94,0,null,null,2,"div",[["class","modal-footer"]],null,null,null,null,null)),(l()(),s.wb(95,0,null,null,1,"button",[["class","btn btn-danger deleteMessageBtn"],["type","button"]],null,null,null,null,null)),(l()(),s.Vb(-1,null,["Delete"]))],(function(l,e){l(e,1,0,"rgba(51, 51, 51, 0.96)","medium","ball-spin-clockwise")}),null)}function w(l){return s.Yb(0,[(l()(),s.wb(0,0,null,null,1,"app-messages",[],null,null,null,v,h)),s.vb(1,114688,null,0,g,[r.a,b.i,p.l,o.c,f.j],null,null)],(function(l,e){l(e,1,0)}),null)}var M=s.sb("app-messages",g,w,{},{},[]),D={title:"Messages"},y=function(){return function(){}}();n.d(e,"MessagesModuleNgFactory",(function(){return I}));var I=s.tb(u,[],(function(l){return s.Ib([s.Jb(512,s.j,s.X,[[8,[a.a,M]],[3,s.j],s.x]),s.Jb(4608,b.o,b.n,[s.u]),s.Jb(1073742336,b.c,b.c,[]),s.Jb(1073742336,p.p,p.p,[[2,p.u],[2,p.l]]),s.Jb(1073742336,y,y,[]),s.Jb(1073742336,o.b,o.b,[]),s.Jb(1073742336,u,u,[]),s.Jb(1024,p.j,(function(){return[[{path:"",component:g,data:D}]]}),[])])}))}}]);